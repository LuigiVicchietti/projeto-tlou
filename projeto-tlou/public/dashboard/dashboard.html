<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" href="../assets/icon-page.webp" type="image/x-icon">
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
    <link rel="stylesheet" href="../css/reset.css">
    <link rel="stylesheet" href="../css/dashboard.css">
    <title>Área Restrita - Projeto</title>
</head>

<body>
    <main id="global_container">
        <nav class="nav" id="nav">
            <button class="btn-menu" id="btn_menu"><img class="nav-img-menu select-disable"
                    src="../assets/img/icons/List.png" alt="Menu"></button>
            <ul class="nav-list" id="nav_list">
                <li id="dash_li" class="now">
                    <a id="a_dash">
                        <img class="li-img select-disable"
                            src="https://static.tvtropes.org/pmwiki/pub/images/fireflies.png" alt="Icone vagalumes">
                        <span class="select-disable">Geral</span>
                    </a>
                </li>
                <li id="qSelec_li">
                    <a id="a_qSelec">
                        <img class="li-img select-disable" src="../assets/img/icons/quiz-icon.png" alt="Icone quiz">
                        <span class="select-disable">Quiz</span>
                    </a>
                </li>
            </ul>
            <a onclick="limparSessao()" href="../login.html">
                <img class="img-sair select-disable" src="../assets/img/icons/exit.png" alt="Sair">
                <span class="select-disable">Sair</span>
            </a>
        </nav>
        <section class="section-content" id="section_content">
            <div class="top-content">
                <h2 class="select-disable">Good <span id="daytime"></span>, <span id="user"></span></h2>
                <div>
                    <div class="interaction select-disable" id="interaction">
                        <button class="select-disable" id="btn_mode">
                            <img src="../assets/img/icons/light.png" alt="Light" id="light">
                            <span id="type_mode">Dark mode</span>
                        </button>
                    </div>
                    <input class="select-disable" type="text" id="input_search" placeholder="Search">
                </div>
            </div>
            <div id="content">
                <div class="content-column" id="content_info">
                    <ul class="info-list">
                        <li name="info_block">
                            <img class="select-disable" src="../assets/img/icons/User.png" alt="Icone de user"
                                id="user_img">
                            <div class="li-info">Usuários cadastrados
                                <span id="qtd_user">0</span>
                            </div>
                        </li>
                        <li name="info_block">
                            <img class="select-disable" src="../assets/img/icons/icon-trofeu.png" alt="Icone de troféu"
                                id="trophy_img">
                            <div class="li-info">Quizes gabaritados
                                <span id="qtd_quiz_gab"></span>
                            </div>
                        </li>
                        <li name="info_block">
                            <img class="select-disable" src="../assets/img/icons/Heart.png" alt="Icone de coração"
                                id="heart_img">
                            <div class="li-info">Quizes curtidos
                                <span id="like_all_quiz">0</span>
                            </div>
                        </li>
                    </ul>
                    <div class="div-table" id="div_table">
                        <table>
                            <thead>
                                <tr class="select-disable">
                                    <th>Pódio</th>
                                    <th>User</th>
                                    <th>Pontuação</th>
                                </tr>
                            </thead>
                            <tbody id="tbody_content">
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="content-column" id="content_charts">
                    <h2>Quantidade de acertos por cada questão</h2>
                    <div class="div-big-chart">
                        <canvas class="select-disable" id="myChart1"></canvas>
                    </div>
                    <div class="div-medium-chart">
                        <div class="medium-chart">
                            <h3>Seus acertos e erros (%)</h3>
                            <div name="div_medium_chart">
                                <canvas class="select-disable" id="myChart2"></canvas>
                            </div>
                        </div>
                        <div class="medium-chart">
                            <h3>Seus acertos X tempo gasto (min)</h3>
                            <div name="div_medium_chart">
                                <canvas class="select-disable" id="myChart3"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div id="content_qSelector">
                <!-- <div class="qCard_container">
                    <div class="qCard select-disable">
                        <img class="img-quiz" src="../assets/img/img-quiz1.jpg" alt="imagem do quiz">
                        <div class="quiz-describe">
                            <h2 id="name_quiz">Quiz Geral</h2>
                            <p>Pronto para desafiar seus conhecimentos sobre a série de jogos de The Last of Us?! Este
                                quiz contém 12 perguntas com quatro possíveis respostas para cada uma delas, sendo as
                                perguntas baseadas na série e no game de The Last of Us.</p>
                        </div>
                        <div class="qCard-actions">
                            <a href="./quiz1.html"><button>Responder</button></a>
                            <div style="display: flex; justify-content: center; align-items: center; font-size: 18px;">
                                <span id="qtdCurtida1">?</span>
                                <button class="btn">
                                    <svg class="icon" width="25" height="25" viewBox="0 0 24 24"
                                        xmlns="http://www.w3.org/2000/svg">
                                        <path
                                            d="M12,21.35L10.55,20.03C5.4,15.36 2,12.27 2,8.5C2,5.41 4.42,3 7.5,3C9.24,3 10.91,3.81 12,5.08C13.09,3.81 14.76,3 16.5,3C19.58,3 22,5.41 22,8.5C22,12.27 18.6,15.36 13.45,20.03L12,21.35Z">
                                        </path>
                                    </svg>
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="qCard-empty select-disable">
                        <img class="soon-warning" src="../assets/img/icons/soon-alert-icon.png" alt="Em breve">
                        <div class="soon-describe">
                            <h3>EM BREVE!</h3>
                            <p>No momento não há mais quizes para responder. Fique atento a novas atualizações, quem
                                sabe um
                                novo quiz é feito, não é mesmo?!</p>
                        </div>
                    </div>
                </div> -->
            </div>
        </section>
    </main>
</body>

</html>
<script type="module" src="../js/funcoes.js"></script>
<script type="module" src="../js/dashboard.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
<script>
    AOS.init();
</script>

<script>
    var username = sessionStorage.NOME_USUARIO;
    user.innerHTML = " " + username;
    const ctx1 = document.getElementById('myChart1');
    const ctx2 = document.getElementById('myChart2');
    const ctx3 = document.getElementById('myChart3');

    var answerPerQuiz = [];

    fetch("/answer_user/answerPerQuestion", {
        method: "POST",
        headers: {
            "Content-Type": "application/json"
        },
        body: JSON.stringify({
            fkQuizServer: 1,
        })
    }).then(function (resposta) {
        console.log("resposta: ", resposta);
        if (resposta.ok) {
            resposta.json().then((jsonAnswerPerQuestion) => {
                jsonAnswerPerQuestion.forEach(question => {
                    answerPerQuiz.push(question.soma);
                });
            }).then(() => {
                loadChart1();
            })
        } else {
            throw ("Houve um erro puxar dados do quiz!");
        }
    }).catch(function (resposta) {
        console.log(`#ERRO: ${resposta}`);
    });

    function loadChart1() {
        new Chart(ctx1, {
            type: 'bar',
            data: {
                labels: ['1° questão', '2° questão', '3° questão', '4° questão', '5° questão', '6° questão', '7° questão', '8° questão', '9° questão', '10° questão', '11° questão', '12° questão'],
                datasets: [{
                    label: 'Quantidade de acertos por cada pergunta do quiz',
                    data: [answerPerQuiz[0], answerPerQuiz[1], answerPerQuiz[2], answerPerQuiz[3], answerPerQuiz[4], answerPerQuiz[5], answerPerQuiz[6], answerPerQuiz[7], answerPerQuiz[8], answerPerQuiz[9], answerPerQuiz[10], answerPerQuiz[11]],
                    backgroundColor: ['rgba(255, 99, 132, 0.6)', 'rgba(255, 159, 64, 0.6)', 'rgba(255, 205, 86, 0.6)', 'rgba(75, 192, 192, 0.6)', 'rgba(54, 162, 235, 0.6)', 'rgba(153, 102, 255, 0.6)', 'rgba(255, 99, 132, 0.6)', 'rgba(255, 159, 64, 0.6)', 'rgba(255, 205, 86, 0.6)', 'rgba(75, 192, 192, 0.6)', 'rgba(54, 162, 235, 0.6)', 'rgba(153, 102, 255, 0.6)'],
                    borderColor: ['rgba(255, 99, 132, 0.9)', 'rgba(255, 159, 64, 0.9)', 'rgba(255, 205, 86, 0.9)', 'rgba(75, 192, 192, 0.9)', 'rgba(54, 162, 235, 0.9)', 'rgba(153, 102, 255, 0.9)', 'rgba(255, 99, 132, 0.9)', 'rgba(255, 159, 64, 0.9)', 'rgba(255, 205, 86, 0.9)', 'rgba(75, 192, 192, 0.9)', 'rgba(54, 162, 235, 0.9)', 'rgba(153, 102, 255, 0.9)'],
                    borderWidth: 1
                }]
            },
            options: {
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }
            }
        });
    }

    var statusArray = [];

    fetch("/answer_user/statusAnswer", {
        method: "POST",
        headers: {
            "Content-Type": "application/json"
        },
        body: JSON.stringify({
            fkUserServer: sessionStorage.ID_USUARIO,
            fkQuizServer: 1,
        })
    }).then(function (resposta) {
        console.log("resposta: ", resposta);
        if (resposta.ok) {
            resposta.json().then((jsonStatusAnswer) => {
                let acertosQuiz = jsonStatusAnswer[0].acertos;
                let errosQuiz = jsonStatusAnswer[0].erros;
                let perAcertos = acertosQuiz / (acertosQuiz + errosQuiz) * 100
                let perErros = errosQuiz / (acertosQuiz + errosQuiz) * 100

                statusArray.push(perAcertos)
                statusArray.push(perErros)
            }).then(() => {
                loadChart2();
            })
        } else {
            throw ("Houve um erro puxar dados do quiz!");
        }
    }).catch(function (resposta) {
        console.log(`#ERRO: ${resposta}`);
    });

    function loadChart2() {
        new Chart(ctx2, {
            type: 'doughnut',
            data: {
                labels: ['Acertos', 'Erros'],
                datasets: [{
                    label: '% de acertos e erros',
                    data: [statusArray[0], statusArray[1]],
                    backgroundColor: ['#74C365', '#FF5555'],
                    borderColor: ['#74C365', '#FF5555'],
                    borderWidth: 1
                }]
            },

            options: {
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }
            }
        });
    }

    var lastAnswer = [];

    document.addEventListener('DOMContentLoaded', () => {
        fetch("/answer_user/showLastStatus", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({
                fkUserServer: sessionStorage.ID_USUARIO,
                fkQuizServer: 1,
            })
        }).then(function (resposta) {
            console.log("resposta: ", resposta);
            if (resposta.ok) {
                resposta.json().then((jsonLastStatus) => {
                    let acertosQuiz = jsonLastStatus[0].acertos;
                    let timeQuiz = jsonLastStatus[0].tempo;

                    var timeConvert = timeQuiz.replace(':00', '').replace(':', '.');
                    Number(timeConvert);
                    
                    lastAnswer.push(acertosQuiz)
                    lastAnswer.push(timeConvert)
                }).then(() => {
                    loadChart3();
                })
            } else {
                throw ("Houve um erro puxar dados do quiz!");
            }
        }).catch(function (resposta) {
            console.log(`#ERRO: ${resposta}`);
        });
    })

    function loadChart3() {
        new Chart(ctx3, {
            type: 'bar',
            data: {
                labels: ['Acertos', 'Tempo gasto'],
                datasets: [{
                    label: 'Acertos em relação ao tempo gasto (min)',
                    data: [lastAnswer[0], lastAnswer[1]],
                    backgroundColor: ['rgba(153, 102, 255, 0.6)', 'rgba(255, 159, 64, 0.8)'],
                    borderColor: ['rgba(153, 102, 255, 0.9)', 'rgba(255, 159, 64, 0.4)'],
                    borderWidth: 1
                }]
            },

            options: {
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }
            }
        });
    }
</script>